@model dynamic

@{
    ViewData["Title"] = "Team Analytics";
    var teamName = ViewBag.TeamName ?? "Team";
}

<div class="page-header fade-in">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="bi bi-bar-chart me-2"></i>Team Analytics</h1>
            <p>Comprehensive performance insights and strategic analytics</p>
        </div>
        <div class="btn-group" role="group">
            <button class="btn btn-secondary" id="last5Matches" data-testid="filter-5-matches">Last 5 Matches</button>
            <button class="btn btn-secondary" id="last10Matches" data-testid="filter-10-matches">Last 10 Matches</button>
            <button class="btn btn-secondary" id="allMatches" data-testid="filter-all-matches">All Matches</button>
        </div>
    </div>
</div>

<!-- Key Performance Indicators -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card fade-in">
            <div class="stat-icon"><i class="bi bi-star-fill"></i></div>
            <div class="stat-value" data-testid="avg-team-rating">7.4</div>
            <div class="stat-label">Avg Team Rating</div>
            <div class="mt-2">
                <small class="text-success">
                    <i class="bi bi-arrow-up"></i> +0.3 from previous period
                </small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card fade-in" style="animation-delay: 0.1s;">
            <div class="stat-icon"><i class="bi bi-trophy-fill"></i></div>
            <div class="stat-value text-success" data-testid="win-rate">75%</div>
            <div class="stat-label">Win Rate</div>
            <div class="mt-2">
                <small class="text-muted">12 wins in 16 matches</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card fade-in" style="animation-delay: 0.2s;">
            <div class="stat-icon"><i class="bi bi-bullseye"></i></div>
            <div class="stat-value text-accent" data-testid="goals-scored">42</div>
            <div class="stat-label">Goals Scored</div>
            <div class="mt-2">
                <small class="text-muted">2.6 per match average</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card fade-in" style="animation-delay: 0.3s;">
            <div class="stat-icon"><i class="bi bi-shield-check"></i></div>
            <div class="stat-value text-warning" data-testid="goals-conceded">18</div>
            <div class="stat-label">Goals Conceded</div>
            <div class="mt-2">
                <small class="text-muted">1.1 per match average</small>
            </div>
        </div>
    </div>
</div>

<!-- Team Rating Trend -->
<div class="row g-4 mb-4">
    <div class="col-12">
        <div class="card fade-in" style="animation-delay: 0.4s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Team Average Rating Trend</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="teamRatingTrendChart" data-testid="rating-trend-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Player Rankings -->
<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card fade-in" style="animation-delay: 0.5s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-award me-2"></i>Top Performers by Average Rating</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="playerRankingChart" data-testid="player-ranking-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card fade-in" style="animation-delay: 0.6s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-list-ol me-2"></i>Top Scorers & Assisters</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Goals</th>
                                <th>Assists</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody data-testid="top-scorers-table">
                            <tr>
                                <td><strong>John Doe</strong></td>
                                <td><span class="badge badge-success">8</span></td>
                                <td><span class="badge badge-info">5</span></td>
                                <td><strong>13</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Mike Smith</strong></td>
                                <td><span class="badge badge-success">6</span></td>
                                <td><span class="badge badge-info">7</span></td>
                                <td><strong>13</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Tom Wilson</strong></td>
                                <td><span class="badge badge-success">7</span></td>
                                <td><span class="badge badge-info">4</span></td>
                                <td><strong>11</strong></td>
                            </tr>
                            <tr>
                                <td><strong>James Brown</strong></td>
                                <td><span class="badge badge-success">5</span></td>
                                <td><span class="badge badge-info">3</span></td>
                                <td><strong>8</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Alex Johnson</strong></td>
                                <td><span class="badge badge-success">4</span></td>
                                <td><span class="badge badge-info">2</span></td>
                                <td><strong>6</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance by Position -->
<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card fade-in" style="animation-delay: 0.7s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-diagram-3 me-2"></i>Performance by Position</h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="positionPerformanceChart" data-testid="position-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card fade-in" style="animation-delay: 0.8s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-house-door me-2"></i>Home vs Away Performance</h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="homeAwayChart" data-testid="home-away-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Form Guide -->
<div class="row g-4">
    <div class="col-12">
        <div class="card fade-in" style="animation-delay: 0.9s;">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-calendar3 me-2"></i>Recent Form</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap" data-testid="form-guide">
                    <div class="form-indicator" style="width: 60px; height: 60px; border-radius: 50%; background: var(--accent-green); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem;" title="Win">
                        W
                    </div>
                    <div class="form-indicator" style="width: 60px; height: 60px; border-radius: 50%; background: var(--accent-green); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem;" title="Win">
                        W
                    </div>
                    <div class="form-indicator" style="width: 60px; height: 60px; border-radius: 50%; background: var(--accent-yellow); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem; color: #1a1d29;" title="Draw">
                        D
                    </div>
                    <div class="form-indicator" style="width: 60px; height: 60px; border-radius: 50%; background: var(--accent-green); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem;" title="Win">
                        W
                    </div>
                    <div class="form-indicator" style="width: 60px; height: 60px; border-radius: 50%; background: var(--accent-green); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem;" title="Win">
                        W
                    </div>
                </div>
                <p class="text-center text-muted mt-4">4 Wins, 1 Draw in last 5 matches</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Team Rating Trend Chart
        const trendCtx = document.getElementById('teamRatingTrendChart');
        if (trendCtx) {
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Match 1', 'Match 2', 'Match 3', 'Match 4', 'Match 5', 'Match 6', 'Match 7', 'Match 8', 'Match 9', 'Match 10'],
                    datasets: [{
                        label: 'Team Average Rating',
                        data: [7.2, 7.5, 7.1, 7.8, 7.4, 7.6, 7.3, 7.9, 7.5, 7.7],
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointBackgroundColor: '#00d4ff',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b8bcc8', font: { size: 14 } }
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 10,
                            ticks: { color: '#b8bcc8', stepSize: 1 },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#b8bcc8' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // Player Ranking Chart
        const rankingCtx = document.getElementById('playerRankingChart');
        if (rankingCtx) {
            new Chart(rankingCtx, {
                type: 'bar',
                data: {
                    labels: ['John Doe', 'Mike Smith', 'Tom Wilson', 'James Brown', 'Alex Johnson'],
                    datasets: [{
                        label: 'Average Rating',
                        data: [8.2, 8.0, 7.8, 7.5, 7.3],
                        backgroundColor: ['#00d4ff', '#00d4ff', '#00d4ff', '#00d4ff', '#00d4ff'],
                        borderColor: ['#00b8e6', '#00b8e6', '#00b8e6', '#00b8e6', '#00b8e6'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            min: 0,
                            max: 10,
                            ticks: { color: '#b8bcc8', stepSize: 1 },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#b8bcc8' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // Position Performance Chart
        const positionCtx = document.getElementById('positionPerformanceChart');
        if (positionCtx) {
            new Chart(positionCtx, {
                type: 'radar',
                data: {
                    labels: ['Defenders', 'Midfielders', 'Forwards'],
                    datasets: [{
                        label: 'Average Rating',
                        data: [7.2, 7.5, 7.8],
                        backgroundColor: 'rgba(0, 212, 255, 0.2)',
                        borderColor: '#00d4ff',
                        borderWidth: 3,
                        pointBackgroundColor: '#00d4ff',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 10,
                            ticks: { color: '#b8bcc8', stepSize: 2, backdropColor: 'transparent' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: '#b8bcc8', font: { size: 14 } }
                        }
                    }
                }
            });
        }

        // Home vs Away Chart
        const homeAwayCtx = document.getElementById('homeAwayChart');
        if (homeAwayCtx) {
            new Chart(homeAwayCtx, {
                type: 'bar',
                data: {
                    labels: ['Home', 'Away'],
                    datasets: [
                        {
                            label: 'Wins',
                            data: [7, 5],
                            backgroundColor: '#00ff88'
                        },
                        {
                            label: 'Draws',
                            data: [1, 1],
                            backgroundColor: '#ffd93d'
                        },
                        {
                            label: 'Losses',
                            data: [0, 2],
                            backgroundColor: '#ff4757'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b8bcc8', font: { size: 12 } }
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            ticks: { color: '#b8bcc8', stepSize: 1 },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#b8bcc8' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }
    </script>
}